#
# build.cfg -- configuration information for building Subversion
#
# This file is processed by ###, creating ###
#

# ----------------------------------------------------------------------------
#
# PREDEFINED SECTIONS
#
# These are global in scope, providing information to the process, rather
# than defining build targets.
#

[includes]
paths = subversion/include/*.h

[static-apache]
# Makefile.in and config.m4 (omit README)
paths = subversion/mod_dav_svn/static/[Mc]*

[test-scripts]
paths =
	subversion/client/tests/*.sh
	subversion/tests/libsvn_fs/run-fs-tests.sh
	subversion/tests/libsvn_subr/target-test.sh
	subversion/tests/libsvn_wc/checkout-test.sh
	subversion/tests/libsvn_repos/run-repos-tests.sh

# ----------------------------------------------------------------------------
#
# BUILD TARGETS
#

[svn]
type = exe
path = subversion/client
group = programs
libs = libsvn_client libsvn_wc libsvn_ra libsvn_delta libsvn_subr
	$(SVN_APR_LIBS) libexpat

[svnadmin]
type = exe
path = subversion/svnadmin
group = fs-programs
libs = libsvn_fs libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
install = sbin

[libsvn_client]
type = lib
path = subversion/libsvn_client
group = libs

[libsvn_delta]
type = lib
path = subversion/libsvn_delta
group = libs

[libsvn_fs]
type = lib
path = subversion/libsvn_fs
group = fs-libs
libs = $(SVN_DB_LIBS)

[libsvn_ra]
type = lib
path = subversion/libsvn_ra
group = libs
# conditionally link in some more libs
libs = $(SVN_RA_LIB_LINK)
# conditionally add more dependencies
add-deps = $(SVN_RA_LIB_DEPS)

[libsvn_ra_dav]
type = lib
path = subversion/libsvn_ra_dav
group = libs
### hack to deal with libtool's busted intra-library dependencies
libs = -L$(abs_builddir)/neon/src/.libs -lneon

[libsvn_ra_local]
type = lib
path = subversion/libsvn_ra_local
group = fs-libs
libs = libsvn_repos libsvn_fs libsvn_delta libsvn_subr

[libsvn_repos]
type = lib
path = subversion/libsvn_repos
group = fs-libs

[libsvn_subr]
type = lib
path = subversion/libsvn_subr
group = libs

[libsvn_wc]
type = lib
path = subversion/libsvn_wc
group = libs

[libmod_dav_svn]
type = lib
path = subversion/mod_dav_svn
group = apache-mods
libs = libsvn_repos libsvn_fs libsvn_delta libsvn_subr
# we don't need the .so version stuff for an Apache module, so avoid them
link-flags = -avoid-version
# need special build rules to include the Apache headers
custom = apache-mod
install = apache-mod

[libexpat]
type = lib
path = expat-lite
group = libs
# there are some .c files included by others, so *.c isn't appropriate
sources = hashtable.c xmlparse.c xmlrole.c xmltok.c

# ----------------------------------------------------------------------------
#
# TESTING TARGETS
#

[libsvn_test]
type = lib
path = subversion/tests
sources = svn_tests_main.c svn_test_editor.c
install = test
group = libs

[libsvn_test_fs]
type = lib
path = subversion/tests
sources = fs-helpers.c
install = test
group = fs-libs

[deltaparse-test]
type = exe
path = subversion/tests/libsvn_delta
sources = deltaparse-test.c
install = test
group = programs
libs = libsvn_test libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

[svndiff-test]
type = exe
path = subversion/tests/libsvn_delta
sources = svndiff-test.c
install = test
group = programs
libs = libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

[vdelta-test]
type = exe
path = subversion/tests/libsvn_delta
sources = vdelta-test.c
install = test
group = programs
libs = libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

[random-test]
type = exe
path = subversion/tests/libsvn_delta
sources = random-test.c
install = test
group = programs
libs = libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat

[xml-output-test]
type = exe
path = subversion/tests/libsvn_delta
sources = xml-output-test.c
install = test
group = programs
libs = libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

[fs-test]
type = exe
path = subversion/tests/libsvn_fs
sources = fs-test.c
install = test
group = fs-programs
libs = libsvn_test libsvn_test_fs libsvn_fs libsvn_delta libsvn_subr
	$(SVN_APR_LIBS) libexpat
# run-fs-tests.sh will run this for us
testing = skip

[skel-test]
type = exe
path = subversion/tests/libsvn_fs
sources = skel-test.c
install = test
group = fs-programs
libs = libsvn_test libsvn_fs libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# run-fs-tests.sh will run this for us
testing = skip

[ra-local-test]
type = exe
path = subversion/tests/libsvn_ra_local
sources = ra-local-test.c
install = test
group = fs-programs
libs = libsvn_test libsvn_ra libsvn_fs libsvn_delta libsvn_subr
	$(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

[repos-test]
type = exe
path = subversion/tests/libsvn_repos
sources = repos-test.c dir-delta-editor.c
install = test
group = fs-programs
libs = libsvn_test libsvn_test_fs libsvn_repos libsvn_fs libsvn_delta
	libsvn_subr $(SVN_APR_LIBS) libexpat
# run-repos-tests.sh will run this for us
testing = skip

[hashdump-test]
type = exe
path = subversion/tests/libsvn_subr
sources = hashdump-test.c
install = test
group = programs
libs = libsvn_test libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat

[stringtest]
type = exe
path = subversion/tests/libsvn_subr
sources = stringtest.c
install = test
group = programs
libs = libsvn_test libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat

[target-test]
type = exe
path = subversion/tests/libsvn_subr
sources = target-test.c
install = test
group = programs
libs = libsvn_subr $(SVN_APR_LIBS) libexpat
# target-test.sh will run this for us
testing = skip

[path-test]
type = exe
path = subversion/tests/libsvn_subr
sources = path-test.c
install = test
group = programs
libs = libsvn_test libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat

[checkout-test]
type = exe
path = subversion/tests/libsvn_wc
sources = checkout-test.c
install = test
group = programs
libs = libsvn_wc libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# checkout-test.sh will run this for us
testing = skip

[commit-test]
type = exe
path = subversion/tests/libsvn_wc
sources = commit-test.c
install = test
group = programs
libs = libsvn_test libsvn_wc libsvn_delta libsvn_subr $(SVN_APR_LIBS) libexpat
# disabled for now
testing = skip

# ----------------------------------------------------------------------------
#
# DOC TARGETS
#

#[svn-design]
#type = doc
#path = doc
#group = docs
#sources = svn-design.texi
#deps = ...

# ----------------------------------------------------------------------------
